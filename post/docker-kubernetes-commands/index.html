<!DOCTYPE html>
<html lang="en-us">
<head><head>
    <meta name="referrer" content="no-referrer"/>
    <meta name="google-site-verification" content="9vIieCe-Qpd78QOmBl63rGtIVbhY6sYyuxX3j8XWBA4" />
    <meta name="baidu-site-verification" content="LRrmH41lz7" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="常用命令说明">
    
    <meta name="keyword"  content="暴走的初号机, shinji3887, 暴走的初号机的网络日志, 暴走的初号机的博客, shinji3887 Blog, 博客, 个人网站, 互联网, Web, 云原生, PaaS, Istio, Kubernetes, 微服务, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>docker与kubernetes常用命令集合-同步率400%</title>

    <link rel="canonical" href="/post/docker-kubernetes-commands/">

    <link rel="stylesheet" href="https://lupeier.cn-sh2.ufileos.com/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="https://lupeier.cn-sh2.ufileos.com/bootstrap.min.css">

    
    <link rel="stylesheet" href="https://lupeier.cn-sh2.ufileos.com/hux-blog.min.css">

    
    <link rel="stylesheet" href="https://lupeier.cn-sh2.ufileos.com/syntax.css">

    
    <link rel="stylesheet" href="https://lupeier.cn-sh2.ufileos.com/zanshang.css">

    
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <script src="https://lupeier.cn-sh2.ufileos.com/jquery.min.js"></script>
    
    
    <script src="https://lupeier.cn-sh2.ufileos.com/bootstrap.min.js"></script>
    
    
    <script src="https://lupeier.cn-sh2.ufileos.com/hux-blog.min.js"></script>
</head>
</head>

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">L&#39; HandBook</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="categories/tech">Tech</a>
                    </li>
                    
                    <li>
                        <a href="categories/tips">Tips</a>
                    </li>
                    
                    <li>
                        <a href="/about">About</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header{
        background-image: url('https://lupeier.cn-sh2.ufileos.com/clouds-dawn-dock-891822.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                       
                       <a class="tag" href="/tags/docker" title="Docker">
                           Docker
                        </a>
                        
                       <a class="tag" href="/tags/kubernetes" title="Kubernetes">
                           Kubernetes
                        </a>
                        
                    </div>
                    <h1>docker与kubernetes常用命令集合</h1>
                    <h2 class="subheading"></h2>
                    <span  class="meta">Posted by L&#39; on Tuesday, November 20, 2018
                        
                    </span>
					<br>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

        		
                        <header>
                        <h2>TOC</h2>
                        </header>
                        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#docker命令">docker命令</a></li>
<li><a href="#kubectl命令">kubectl命令</a></li>
</ul></li>
</ul>
</nav>
        		
        		

<blockquote>
<p>docker与kubernetes常用命令行集合，做个整理，妈妈再也不用担心我记不住命令了。只根据需要记录了主要的命令和参数，应该足够用了，全量的命令列表请参考官方文档</p>
</blockquote>

<h2 id="docker命令">docker命令</h2>

<pre><code class="language-bash">docker images
</code></pre>

<p>列出当前本地的所有镜像</p>

<pre><code class="language-bash">docker ps
</code></pre>

<p>查看当前所有正在运行的容器进程</p>

<ul>
<li>-a：查看所有容器（包含不在运行的）</li>
</ul>

<pre><code class="language-bash">docker pull nginx:latest
</code></pre>

<p>拉取指定名称及版本的镜像,不指定tag名称时默认拉取latest</p>

<pre><code class="language-bash">docker tag nginx:latest 22.196.66.62:5000/nginx:latest
</code></pre>

<p>标记本地镜像，将其归入某一仓库(比如内网私有仓库)，也会用来给墙外的一些镜像改名（ex:gcr.io）。</p>

<pre><code class="language-bash">docker push 22.196.66.62:5000/nginx:latest
</code></pre>

<p>将镜像推送入dockerhub或者私有仓库</p>

<pre><code class="language-bash">docker run -p 8080:80 --name mynginx -d nginx:latest
</code></pre>

<p>运行docker镜像</p>

<ul>
<li>-d: 后台运行容器，并返回容器ID；</li>
<li>-i: 以交互模式运行容器，通常与 -t 同时使用；</li>
<li>-p: 端口映射，格式为：主机(宿主)端口:容器端口</li>
<li>-t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；</li>
<li>&ndash;name=&ldquo;mynginx&rdquo;: 为容器指定一个名称；</li>
<li>&ndash;cpuset=&ldquo;0-2&rdquo; or &ndash;cpuset=&ldquo;0,1,2&rdquo;: 绑定容器到指定CPU运行；</li>
<li>-m :设置容器使用内存最大值；</li>
<li>&ndash;net=&ldquo;bridge&rdquo;: 指定容器的网络连接类型，支持 bridge/host/none/container: 四种类型,默认为桥接模式</li>
</ul>

<pre><code class="language-bash">docker exec -it  mynginx /bin/bash
</code></pre>

<p>以bash方式在容器mynginx中开启一个交互模式的终端</p>

<pre><code class="language-bash">docker rm mynginx
</code></pre>

<p>删除容器，需要该容器此时是stop状态</p>

<pre><code class="language-bash">docker rmi nginx:latest
</code></pre>

<p>删除镜像，需要此时没有该镜像创建的关联容器</p>

<pre><code class="language-bash">docker logs --since=&quot;2016-07-01&quot; --tail=10 mynginx
</code></pre>

<p>查看容器日志logs</p>

<ul>
<li>-f : 跟踪日志输出</li>
<li>&ndash;since :显示某个开始时间的所有日志</li>
<li>-t : 显示时间戳</li>
<li>&ndash;tail :仅列出最新N条容器日志</li>
</ul>

<pre><code class="language-bash">docker build -t myapp:v0.1 .
</code></pre>

<p>构建镜像，需要在当前目录下有Dockerfile文件，.代表为当前路径</p>

<ul>
<li>&ndash;tag, -t: 镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签</li>
<li>-f :指定要使用的Dockerfile路径</li>
</ul>

<pre><code class="language-bash">docker save -o mynginx.tar nginx:latest
</code></pre>

<p>将镜像nginx:latest 生成mynginx.tar归档文件</p>

<pre><code class="language-bash">docker load -i mynginx.tar
</code></pre>

<p>从mynginx.tar归档中载入镜像</p>

<pre><code class="language-bash">docker cp /www/runoob 96f7f14e99ab:/www/
</code></pre>

<p>将宿主机/www/runoob目录拷贝到容器96f7f14e99ab的/www目录下</p>

<h2 id="kubectl命令">kubectl命令</h2>

<pre><code class="language-bash">kubectl cluster-info
</code></pre>

<p>显示集群信息</p>

<p>k8s中一切皆为对象，对于资源对象操作的关键词分别有get、create、edit、delete等等（传说中的CRUD），下面简单列举一下</p>

<pre><code class="language-bash">kubectl get pods -o wide
</code></pre>

<p>get关键词，获取默认namespace下的所有pods信息，pods可替换为k8中其他可以操作的对象，对象太多，这边捡主要的说说，下边其他的操作需要操作资源对象都是一样的</p>

<ul>
<li>all  列出全部对象</li>
<li>clusters (valid only for federation apiservers)</li>
<li>configmaps (aka &lsquo;cm&rsquo;)</li>
<li>deployments (aka &lsquo;deploy&rsquo;)</li>
<li>ingresses (aka &lsquo;ing&rsquo;)</li>
<li>jobs</li>
<li>namespaces (aka &lsquo;ns&rsquo;)</li>
<li>nodes (aka &lsquo;no&rsquo;)</li>
<li>persistentvolumeclaims (aka &lsquo;pvc&rsquo;)</li>
<li>persistentvolumes (aka &lsquo;pv&rsquo;)</li>
<li>pods (aka &lsquo;po&rsquo;)</li>
<li>replicasets (aka &lsquo;rs&rsquo;)</li>
<li>replicationcontrollers (aka &lsquo;rc&rsquo;)</li>
<li>roles</li>
<li>secrets</li>
<li>serviceaccounts (aka &lsquo;sa&rsquo;)</li>
<li>services (aka &lsquo;svc&rsquo;)</li>
<li>statefulsets</li>
</ul>

<p>常用附加的参数有：</p>

<ul>
<li>-o yaml  以yaml格式输出</li>
<li>-o json   以json格式输出</li>
<li>-o wide  列表输出详细信息</li>
<li>&ndash;name-space=kube-system 展示kube-system命名空间下的pods</li>
<li>&ndash;all-namespaces  展示全部命名空间下的pods</li>
</ul>

<pre><code class="language-bash">kubectl run nginx --image=nginx --replicas=5 --port=80
</code></pre>

<p>这条命令执行完后会创建一个deployment，里面包含5个副本（pods），暴露容器的80端口，可以使用<code>kubectl get deploy</code>查看刚才创建的deployment</p>

<pre><code class="language-bash">kubectl expose deploy nginx --port=8080 --target-port=80
</code></pre>

<p>为刚才创建的deployment对象创建service代理，并通过Service的8080端口转发至容器的80端口上。可代理的资源有pod（po），service（svc），replication controller（rc），deployment（deploy），replica set（rs）</p>

<ul>
<li>&ndash;type  有三种，ClusterIP, NodePort, or LoadBalancer. 默认是ClusterIP，这种模式的service只能给集群内的pod访问，若需要外部访问集群内pod，则需要设置为NodePort模式。</li>
</ul>

<pre><code class="language-bash">kubectl create -f docker-registry.yaml
</code></pre>

<p>从一个yaml文件中创建资源，资源类型由yaml文件定义，也可以后面加资源类型直接创建相关对象，比如</p>

<ul>
<li>role</li>
<li>configmap</li>
<li>quota</li>
<li>namespace</li>
<li>secret</li>
</ul>

<pre><code class="language-bash">kubectl edit deploy nginx
</code></pre>

<p>编辑nginx这个deployment的配置文件</p>

<pre><code class="language-bash">kubectl delete deploy,svc nginx
</code></pre>

<p>删除标签为nginx的deployment及service对象</p>

<pre><code class="language-bash">kubectl scale --replicas=3 deploy nginx
</code></pre>

<p>K8S当中的重头功能，对pods数量进行水平的扩容或者收缩，该命令将nginx这个deployment的副本数设置为3</p>

<pre><code class="language-bash">kubectl patch deploy nginx -p '{&quot;spec&quot;:{&quot;unschedulable&quot;:true}}'
</code></pre>

<p>更新nginx这个deployment中的指定字段</p>

<pre><code class="language-bash">kubectl set image deployment nginx nginx=nginx:1.9.1
</code></pre>

<p>将nginx这个deployment的镜像更新为nginx:1.9.1，这个操作会触发deployment的滚动更新，通常用于应用更新</p>

<pre><code class="language-bash">kubectl describe pod podid
</code></pre>

<p>输出指定资源的详细描述，支持的资源包括但不限于（大小写不限）：pods (po)、services (svc)、 replicationcontrollers (rc)、nodes (no)、events (ev)、componentstatuses (cs)、 limitranges (limits)、persistentvolumes (pv)、persistentvolumeclaims (pvc)、 resourcequotas (quota)和secrets</p>

<pre><code class="language-bash">kubectl logs -f --tail=20 nginx
</code></pre>

<p>仅输出pod nginx中最近的20条日志</p>

<pre><code class="language-bash">kubectl exec -it 123456-7890 /bin/sh
</code></pre>

<p>进入pod 123456-7890并分配一个交互终端</p>

<pre><code class="language-bash">kubectl apply -f FILENAME
</code></pre>

<p>通过文件名或控制台输入，对资源进行配置。apply命令的使用方式同replace相同，不同的是，apply不会删除原有resource，然后创建新的。apply直接在原有resource的基础上进行更新。同时kubectl apply还会resource中添加一条注释，标记当前的apply。类似于git操作。</p>

        
                
        
              <hr>
              <ul class="pager">
                  
                  <li class="previous">
                      <a href="/post/linux-npm-install-eacces/" data-toggle="tooltip" data-placement="top" title="linux下使用npm install报EACCES的解决方法">&larr; Previous Post</a>
                  </li>
                  
                  
                  <li class="next">
                      <a href="/post/thread-pool-task-executor/" data-toggle="tooltip" data-placement="top" title="使用ThreadPoolTaskExecutor对任务进行异步阻塞处理">Next Post &rarr;</a>
                  </li>
                  
              </ul>
  
              


            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                     
                    
                        
                    
                        
                            <a href="/tags/cloud-native" title="Cloud Native">
                                Cloud Native
                            </a>
                        
                    
                        
                            <a href="/tags/devops" title="DevOps">
                                DevOps
                            </a>
                        
                    
                        
                            <a href="/tags/docker" title="Docker">
                                Docker
                            </a>
                        
                    
                        
                    
                        
                    
                        
                            <a href="/tags/kubernetes" title="Kubernetes">
                                Kubernetes
                            </a>
                        
                    
                        
                            <a href="/tags/microservice" title="Microservice">
                                Microservice
                            </a>
                        
                    
                        
                            <a href="/tags/restful" title="RESTful">
                                RESTful
                            </a>
                        
                    
                        
                    
                        
                            <a href="/tags/spring-cloud" title="Spring Cloud">
                                Spring Cloud
                            </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <a href="/tags/vue" title="vue">
                                vue
                            </a>
                        
                    
                        
                    
                    </div>
                </section>

                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a target="_blank" href="https://skyao.io/">小剑的博客</a></li>
                    
                        <li><a target="_blank" href="https://zhaohuabing.com/">huabing的博客</a></li>
                    
                        <li><a target="_blank" href="http://blog.didispace.com/">程序猿DD的博客</a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="L&#39; HandBook" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:18016380795@163.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="/link%20of%20wechat%20QR%20code%20image">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://github.com/shinji3887">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/lupeier">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; L&#39; HandBook , 2018
		
                    
                </p>
            </div>
        </div>
    </div>
</footer>



<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("/js/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https'){
       bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else{
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>







</body>
</html>
